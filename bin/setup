#!/usr/bin/env sh

has_cmd() {
  command -v "$1" >/dev/null 2>&1
}

die() {
  printf 'ERROR: %s\n' "$1" >&2
  exit 1
}

nu_install() {
  if has_cmd dnf; then
    sudo dnf install -y nu
  elif has_cmd pacman; then
    sudo pacman -S --noconfirm nushell
  elif has_cmd brew; then
    brew install nushell
  else
    if ! has_cmd pixi; then
      curl -fsSL https://pixi.sh/install.sh | bash
    fi
    export PATH="$HOME/.pixi/bin:$PATH"
    pixi global install nushell
  fi
  has_cmd nu || die "nu installation failed"
}

run_setup_nu() {
  tmp=$(mktemp /tmp/setup.nu.XXXXXX)
  url="https://raw.githubusercontent.com/pervezfunctor/linux-config/master/bin/setup.nu"

  if has_cmd curl; then
    curl -fsSL "$url" -o "$tmp" || die "Failed to download setup.nu"
  elif has_cmd wget; then
    wget -qO "$tmp" "$url" || die "Failed to download setup.nu"
  else
    die "Neither curl nor wget found"
  fi

  nu "$tmp"
  rm -f "$tmp"
}

export PATH="$HOME/.local/bin:$PATH"

nu_install
run_setup_nu
